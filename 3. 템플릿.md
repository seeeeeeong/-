# 토비의 스프링 3.1 - 템플릿

스프링의 핵심은 객체 지향이며, 우리는 오브젝트와 그 관계에 큰 관심을 가진다.  
프로그램은 끊임없이 변화하는 존재이며, 그에 따라서 우리는 변화에 유연하게 대응할 수 있는 설계를 해야 한다.

즉, 분리와 확장이 가능한 구조가 중요하다.

---

## 문제 상황

DB에 접근하는 코드를 예로 들어보자.

```java
Connection conn = dataSource.getConnection();
PreparedStatement ps = conn.prepareStatement(sql);
ResultSet rs = ps.executeQuery();
while(rs.next()) {
    // 데이터 처리
}
rs.close();
ps.close();
conn.close();
```

이 코드에는 반복적인 처리와 동시에, 변화 가능성이 높은 로직이 섞여 있다.  
즉, 반복과 변화가 한 코드에 뒤섞여 있어 유지보수가 어렵다.

---

## 템플릿 패턴

템플릿 패턴의 핵심은 변하지 않는 부분과 변하는 부분을 명확히 분리하는 것이다.

- **템플릿** : 반복되는 공통 로직  
- **전략(Strategy)** : 변화가 예상되는 핵심 로직  

템플릿은 전체 알고리즘의 골격을 정의하고, 전략을 통해 변화를 주입한다.  
이렇게 하면 반복 로직은 템플릿이 책임지고, 우리는 핵심 로직에만 집중할 수 있다.

---

## JdbcTemplate을 통한 구현 예

스프링은 `JdbcTemplate`을 통해 템플릿 패턴을 구현하였다.

```java
String sql = "SELECT name FROM users WHERE id=?";
String name = jdbcTemplate.queryForObject(sql, new Object[]{id}, String.class);
```

- Connection 생성, PreparedStatement 초기화, ResultSet 처리 (**Template**)  
- SQL 실행 결과 반환 (**Strategy**)  

---

## 전략 패턴과의 결합

템플릿은 전략 패턴과 결합될 때 가장 큰 효과를 발휘한다.

```java
interface RowMapper<T> {
    T mapRow(ResultSet rs) throws SQLException;
}

class UserRowMapper implements RowMapper<User> {
    public User mapRow(ResultSet rs) throws SQLException {
        return new User(rs.getInt("id"), rs.getString("name"));
    }
}

User user = jdbcTemplate.queryForObject(
    "SELECT * FROM users WHERE id=?",
    new Object[]{id},
    new UserRowMapper()
);
```

- **JdbcTemplate** → 전체 흐름과 반복 처리를 담당하는 템플릿  
- **RowMapper** → 결과 반환이라는 핵심 변화 지점을 담당하는 전략  

템플릿과 전략이 명확히 분리되었기 때문에, 변화가 생겨도 코드 대부분을 수정할 필요가 없다.

---

## 템플릿 패턴의 장점

- 재사용성 향상 : 반복 로직은 재사용 가능  
- 유연성 확보 : 전략만 교체하면 변화에 대응 가능  
- 가독성 개선  
- 테스트 용이  
