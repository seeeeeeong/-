

# 토비의 스프링 5장 - 서비스 추상화

스프링의 가장 큰 강점 중 하나는 **변화에 유연하게 대응할 수 있는 구조**를 만드는 것이다. 특히, **외부 기술이나 환경이 바뀌었을 때 애플리케이션 코드가 직접 영향을 받지 않도록 차단**하는 것이 중요하다.

---

## 1. 문제 상황: 외부 환경 의존성

애플리케이션은 종종 외부 환경에 직접 의존한다. 예를 들어, 비밀번호를 암호화한다고 가정해보자.

```java
MessageDigest md = MessageDigest.getInstance("SHA-256");
md.update(password.getBytes());
byte[] hash = md.digest();
```

겉보기엔 문제없어 보이지만, 몇 가지 문제가 생길 수 있다.

- 암호화 알고리즘을 바꿔야 한다면?
- 다른 암호화 라이브러리를 써야 한다면?
- 환경마다 구현체가 조금씩 다르다면?

→ 결국 코드 곳곳에 흩어진 **외부 API 의존성** 때문에 유연하지 못하다.

---

## 2. 서비스 추상화란?

**서비스 추상화(Service Abstraction)** 란, 외부 기술이나 환경에 종속되는 부분을 **인터페이스**와 **스프링 빈**으로 감싸서 애플리케이션 코드가 직접 의존하지 않도록 만드는 것이다.

- **외부 기술 (구현체)** → 직접 의존  X
- **서비스 추상화 (인터페이스)** → 간접 의존 O

---

## 3. 트랜잭션 서비스 추상화

스프링이 제공하는 대표적인 서비스 추상화는 **트랜잭션**이다.

JDBC, JTA, Hibernate 등 기술마다 트랜잭션을 다루는 방식이 다르다. 만약 애플리케이션 코드가 JDBC API에 직접 의존한다면, JTA로 바꾸는 순간 모든 코드를 수정해야 한다.

이를 해결하기 위해 스프링은 **PlatformTransactionManager** 라는 추상화 인터페이스를 제공한다.

```java
public interface PlatformTransactionManager {
    TransactionStatus getTransaction(TransactionDefinition definition);
    void commit(TransactionStatus status);
    void rollback(TransactionStatus status);
}
```

기술별로 각각의 구현체를 두어, 애플리케이션은 항상 `PlatformTransactionManager` 만 바라보면 된다.

- JDBC → `DataSourceTransactionManager`
- JTA → `JtaTransactionManager`
- Hibernate → `HibernateTransactionManager`

→ 코드 수정 없이 설정만 바꾸면 트랜잭션 기술을 교체할 수 있다.

---

## 4. 서비스 추상화의 장점

1. **환경 독립성 확보** → 코드가 특정 기술이나 환경에 묶이지 않는다.
2. **테스트 용이성** → 구현체를 교체하거나 목/스텁으로 대체 가능.
3. **유연한 확장성** → 새로운 기술이 등장해도 추상화 인터페이스만 유지하면 손쉽게 교체 가능.

---

## 5. DI와 서비스 추상화의 결합

서비스 추상화는 **DI(Dependency Injection)** 와 함께할 때 진정한 힘을 발휘한다.

- 추상화된 인터페이스를 애플리케이션 코드에서 의존
- 구체적인 구현체는 스프링 설정(XML, Java Config, @Bean 등)에서 주입

```java
@Bean
public PlatformTransactionManager transactionManager(DataSource dataSource) {
    return new DataSourceTransactionManager(dataSource);
}
```

→ 애플리케이션은 언제나 `PlatformTransactionManager` 만 사용
→ 실제 환경(JDBC, JTA, Hibernate 등)은 설정으로만 제어

---

## 6. 서비스 추상화의 적용 예시

스프링은 다양한 기술에 대해 서비스 추상화를 제공한다.

- **트랜잭션 추상화** : `PlatformTransactionManager`
- **메일 전송 추상화** : `JavaMailSender`
- **작업 실행 추상화** : `TaskExecutor`
- **ORM 추상화** : `JpaTemplate`, `HibernateTemplate` 등

→ 덕분에 개발자는 외부 기술의 복잡한 API에 직접 의존하지 않고, 일관된 방식으로 필요한 기능을 사용할 수 있다.

---

## 7. 핵심 요약

- **문제** : 외부 기술/환경 의존성 → 코드 변경 비용 증가
- **해결** : 서비스 추상화 (인터페이스 + DI)
- **대표 사례** : 트랜잭션 추상화 (`PlatformTransactionManager`)
- **장점** : 환경 독립성, 유연성, 테스트 용이성 확보
